# Iron Bank SafeBox Attack Chain Evidence

## Executive Summary

Investigation of SafeBox (ibUSDCv2) contract at `0x08bd64BFC832F1C2B3e07e634934453bA7Fa2db2` reveals a **critical bad debt crisis** stemming from the 2021 Cream Finance exploit.

**Net Assessment: CRITICAL - 44% POTENTIAL HAIRCUT FOR DEPOSITORS**

---

## 1. Protocol Architecture

### Contract Hierarchy
```
SafeBox (ibUSDCv2)
   └── wraps → cyUSDC (Iron Bank)
                 └── wraps → USDC
                 └── controlled by → Comptroller
                                       └── uses → Oracle
```

### Key Addresses
| Contract | Address |
|----------|---------|
| SafeBox (ibUSDCv2) | 0x08bd64BFC832F1C2B3e07e634934453bA7Fa2db2 |
| cyUSDC | 0x76Eb2FE28b36B3ee97F3Adae0C69606eeDB2A37c |
| Comptroller | 0xAB1c342C7bf5Ec5F02ADEA1c2270670bCa144CbB |
| Oracle | 0xbd6f5add9B7A6EB151933CB4EfD50bE4eca71451 |
| SafeBox Governor | 0xe142BAe2338D2c691C267B054b13d38Ce6aC5442 |

---

## 2. Critical Finding: Cream Finance Exploit Bad Debt

### Bad Debt Position
```
Exploiter Address:     0x560A8E3B79d23b0A525E15C6F3486c6A293DDAd2
cyUSDC Borrow:         $6,986,813 USDC
Collateral:            ZERO
Shortfall:             $69,051,292 USD (across all markets)
```

### Impact Analysis
```
Total Borrows:         $15,736,238 USDC
Bad Debt:              $6,986,813 USDC (44.4%)
Healthy Borrows:       $8,749,425 USDC (55.6%)

SafeBox Value:         $14,479,431 USDC
Recoverable (worst):   $8,095,127 USDC
POTENTIAL HAIRCUT:     44%
```

---

## 3. Market State Analysis

### Liquidity Crisis
```
Total Cash:            1 USDC (literally)
Utilization Rate:      100.0000%
Borrow APY:            90.4%
Supply APY:            81.4%
```

### Why 100% Utilization?
- All USDC has been borrowed
- Bad debt borrower (Cream exploiter) will NEVER repay
- Healthy borrowers face 90%+ interest
- No liquidity for withdrawals

---

## 4. Attack Vectors Identified

### VECTOR 1: Race for Liquidity (HIGH RISK)
**Tier**: TIER_2 (MEV infrastructure)
**Profit**: $440,000 potential

**Mechanism**:
1. Monitor mempool for any cyUSDC repayments
2. Front-run with SafeBox.withdraw()
3. Extract liquidity before other depositors
4. Avoid 44% haircut by exiting first

**Economics**:
- If $1M repaid, first $1M of withdrawals get full value
- Remaining $13.5M stays locked
- MEV profit = haircut avoided = $440k on $1M

### VECTOR 2: Credit Account Restriction (CRITICAL FINDING)
SafeBox is classified as a "credit account" in Iron Bank with special restrictions:
- Redemptions blocked: "credit account cannot redeem"
- This means SafeBox has a special credit limit arrangement
- Normal withdrawal mechanics may not apply

### VECTOR 3: Interest Rate Illusory Yield (MEDIUM)
**Displayed APY**: 81.4%
**Real APY**: Much lower

**Why**:
- 44% of borrows (bad debt) accrue interest
- But this interest will NEVER be paid
- Real yield only from healthy borrows
- Displayed APY is misleading

### VECTOR 4: Governor Extraction Risk (LOW)
Governor can call `adminClaim(amount)` to extract any USDC in SafeBox.
- Governor is a contract (not EOA): LOWER RISK
- Current direct USDC balance: $0
- Merkle root for claims: EMPTY

### VECTOR 5: Liquidation Impossible (CONFIRMED)
**Cannot liquidate bad debt because**:
- Exploiter has ZERO collateral
- Shortfall exists but nothing to seize
- Close factor irrelevant (50% of 0 = 0)
- Debt is PERMANENT

---

## 5. Technical Evidence

### Fork Test Results (7/7 Passing)
```
test_BadDebtDocumentation        - PASS (documents $6.98M bad debt)
test_LiquidityCrisis             - PASS (confirms 100% utilization)
test_GovernorExtractionRisk      - PASS (governor is contract, low risk)
test_DepositorHaircutAnalysis    - PASS (44% haircut confirmed)
test_RaceForLiquidity            - PASS ($440k MEV profit potential)
test_InterestRateDynamics        - PASS (illusory yield documented)
test_LiquidationImpossibility    - PASS (no collateral to seize)
```

### Key On-Chain Queries
```solidity
// Bad debt confirmation
ICyToken(CYUSDC).borrowBalanceStored(CREAM_EXPLOITER) = 6986813563472

// No collateral
ICyToken(CYUSDC).balanceOf(CREAM_EXPLOITER) = 0

// Shortfall (underwater)
IComptroller(COMPTROLLER).getAccountLiquidity(CREAM_EXPLOITER)
  = (0, 0, 69051292 * 1e18) // $69M shortfall

// Credit account restriction
ICyToken(CYUSDC).redeemUnderlying(1) // reverts: "credit account cannot redeem"
```

---

## 6. Risk Matrix

| Vector | Feasibility | Impact | Tier | Detection |
|--------|-------------|--------|------|-----------|
| Race for Liquidity | HIGH | $440k MEV | T2 | LOW |
| Interest Illusion | CONFIRMED | Misleading | - | N/A |
| Credit Account Block | CONFIRMED | Withdrawals locked | - | N/A |
| Governor Extraction | LOW | If funds enter | T3 | HIGH |
| Liquidation | IMPOSSIBLE | Bad debt permanent | - | N/A |

---

## 7. Depositor Impact Summary

### Current Status
- **Total Deposited**: $14.48M USDC equivalent
- **Withdrawable**: $0 (100% utilization)
- **Best Case**: Full recovery if all healthy borrows repaid
- **Worst Case**: 44% haircut ($6.38M loss)

### Timeline Projection
Without intervention:
1. Bad debt continues accruing "interest" (illusory)
2. Exchange rate grows but claims become more unreal
3. Any repayment triggers MEV race
4. Depositors in race get full value
5. Late depositors face increasing haircut

---

## 8. Historical Context

### Cream Finance Exploit (2021)
- Attacker borrowed ~$37.5M across Iron Bank markets
- Used flash loans to manipulate sUSD pool
- Created irrecoverable bad debt
- This cyUSDC debt is remnant of that exploit

### Why Not Resolved?
- No collateral to liquidate
- Borrower (exploit contract) cannot/won't repay
- Protocol would need governance action to write off
- No clear mechanism for loss socialization

---

## 9. Recommendations

### For Depositors
1. Monitor for any repayments to cyUSDC
2. Prepare withdrawal transaction for MEV execution
3. Accept potential 44% loss or race for liquidity
4. Consider current position as potentially impaired

### For Protocol
1. Governance proposal to write off bad debt
2. Insurance fund activation if available
3. Communication to depositors about risk
4. Potential restructuring plan

---

## Evidence Files

- `test/IronBankAttack.t.sol` - 7 attack chain tests (all passing)
- `IRON_BANK_EVIDENCE.md` - This document

---

*Generated: 2026-02-04*
*Investigation: Iron Bank SafeBox (ibUSDCv2)*
*Target Address: 0x08bd64BFC832F1C2B3e07e634934453bA7Fa2db2*
