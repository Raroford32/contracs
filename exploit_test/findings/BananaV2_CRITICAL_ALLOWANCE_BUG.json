{
  "finding_id": "BANANA-V2-001",
  "title": "Allowance Spending Updates Wrong Storage Slot",
  "severity": "CRITICAL",
  "status": "E3-VALIDATED",
  "contract": {
    "address": "0x93fa1d7c310692eaf390f951828f8791bc19cb36",
    "name": "BananaV2",
    "chain": "ethereum-mainnet",
    "verified": true
  },
  "vulnerability": {
    "category": "ACCOUNTING_DIVERGENCE",
    "type": "STORAGE_SLOT_CORRUPTION",
    "location": {
      "file": "BananaV2.sol",
      "function": "_spendAllowance",
      "line": 116
    },
    "root_cause": "Variable naming confusion: uses inherited 'owner' instead of parameter 'from'",
    "vulnerable_code": "_approve(owner, spender, currentAllowance - value);",
    "correct_code": "_approve(from, spender, currentAllowance - value);"
  },
  "impact": {
    "description": "Any user who receives token approval can drain the entire balance of the approver",
    "affected_functions": ["transferFrom", "burnFrom"],
    "attack_complexity": "TRIVIAL",
    "privileges_required": "NONE (just need any approval)"
  },
  "exploit": {
    "steps": [
      "1. Attacker gets approved for any amount N by victim",
      "2. Attacker calls transferFrom(victim, attacker, N)",
      "3. Allowance check passes but wrong slot is updated",
      "4. Victim's allowance remains at N",
      "5. Repeat step 2-4 until victim balance is 0"
    ],
    "attacker_tier": "TIER_0",
    "capital_required": "NONE",
    "gas_cost_per_iteration": 65000,
    "net_profit": "victim_balance - gas_costs"
  },
  "evidence": {
    "traverse_tools": {
      "sol2cg": {
        "finding": "Edge n81 -> n53 shows (owner, spender, currentAllowance - value) passed to _approve",
        "path": "exploit_test/traverse_analysis/BananaV2_0x93fa1d7c/call_graph.txt"
      },
      "sol_storage_analyzer": {
        "finding": "transferFrom reads allowance but DOES NOT write to it",
        "path": "exploit_test/traverse_analysis/BananaV2_0x93fa1d7c/storage_analysis.txt"
      }
    },
    "poc_test": "exploit_test/test/BananaV2AllowanceBug.t.sol"
  },
  "timeline": {
    "discovered": "2026-02-03T18:20:00Z",
    "validated": "2026-02-03T18:30:00Z"
  },
  "classification": {
    "cwe": ["CWE-682", "CWE-840"],
    "swc": ["SWC-105"]
  }
}
