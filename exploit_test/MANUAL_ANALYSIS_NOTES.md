# Manual Vulnerability Analysis Notes

## Session: Deep Analysis of contracts.txt

### Methodology
- Fetched contract source code via Etherscan API
- Analyzed state machines and emergent behavior
- Ran tests on mainnet fork to verify findings
- Calculated exact profit potential for attack vectors

---

## Contract Analysis Results

### 1. DolaSavings (0xE5f24791E273Cb96A1f8E5B67Bc2397F0AD9B8B4)

**Status: THEORETICAL VULNERABILITY - NOT EXPLOITABLE**

**Attack Vector:** Flash stake attack could capture 90% of pending rewards
- Flash loan DOLA from Balancer (0% fee)
- Stake massive amount, capture disproportionate rewards
- Unstake and repay

**Reality Check:**
- DBR balance in contract = 0
- No rewards to claim even if attack executed
- Theoretical issue but currently not exploitable

**Proof:** `test/ImmediateExploitSearch.t.sol` - testExactFlashLoanProfit()

---

### 2. 1inch st1INCH Pods System (0x9A0C8Ff858d273f57072D714bca7411D717501D7)

**Status: DESIGN ISSUE - NOT IMMEDIATE EXPLOIT**

**Findings:**
- When user adds a pod retroactively, pod receives notification as if tokens just deposited
- Pod call gas limit: 500,000 (sufficient for most operations)
- Pods limit: 5 per user

**Attack Scenario:**
- If a reward pod distributes based on "staking time"
- User stakes WITHOUT the reward pod
- Later adds reward pod
- Pod thinks user just staked - could game time-based rewards

**Why Not Immediate Exploit:**
- Depends on specific pod implementations
- No official 1inch reward pods identified with this issue
- User-controlled pod addition

**Proof:** `test/St1inchPodsAnalysis.t.sol`

---

### 3. Eigen Token (0xec53bf9167f50cdeb3ae105f56099aaab9061f83 proxy -> 0x2c4a81e257381f87f5a5c4bd525116466d972e50)

**Status: DESIGN DECISION - NOT VULNERABILITY**

**Findings:**
- `totalSupply()` returns `bEIGEN.totalSupply()` instead of actual EIGEN supply
- Minters can mint EIGEN without providing bEIGEN
- Transfer restrictions via allowlists (allowedFrom/allowedTo)

**Why Not Exploit:**
- Intentional design for backing token mechanics
- Minting restricted to authorized minters
- Would only affect external integrations that incorrectly assume totalSupply

---

### 4. Chainlink RewardVault (0x996913c8c08472f584ab8834e925b06D0eb1D813)

**Status: NO ISSUES FOUND**

**State:**
- LINK balance: 2.7M tokens
- Community/Operator/Delegated emission rates configured
- Not paused

**Analysis:**
- Standard emission-based reward distribution
- No obvious precision or timing exploits
- Access control properly implemented

**Proof:** `test/RewardVaultAnalysis.t.sol`

---

### 5. AevoStaking (0x38913051e01d4f6910cb66bb9ac3cb77d746ad81)

**Status: NO IMMEDIATE ISSUES**

**Findings:**
- uint16 epoch overflow: 458,066 days away (not immediate concern)
- Window size: 9 epochs
- Sliding window underflow: Not at risk with current epoch = 97

**Proof:** `test/AevoStakingAnalysis.t.sol`

---

### 6. Curve Peg Keeper V2 (0x9201da0D97CaAAff53f01B2fB56767C7072dE340)

**Status: UNABLE TO TEST - CONTRACT NOT FOUND**

**Notes:**
- Contract at address returns NotActivated errors
- May be on different chain or deactivated
- Need to verify correct address

---

### 7. EthenaMinting (0xe3490297a08d6fC8Da46Edb7B6142E4F461b62D3)

**Status: DESIGN INEFFICIENCY - NOT EXPLOITABLE**

**Key Finding: Nonce Bitmap Collision**
```solidity
function verifyNonce(address sender, uint128 nonce) public view returns (uint128, uint256, uint256) {
    if (nonce == 0) revert InvalidNonce();
    uint128 invalidatorSlot = uint64(nonce) >> 8;  // Only uses bits 8-71
    uint256 invalidatorBit = 1 << uint8(nonce);    // Only uses bits 0-7
    ...
}
```

**Analysis:**
- Nonce is uint128 (128 bits) but only 72 bits are used
- Two different nonces differing in bits 72-127 map to same bitmap position
- Example: nonces 0x1234567890ABCDEF12 and 0x1234567890ABCDEF12 + 2^72 collide

**Why NOT Exploitable:**
- Signature covers the FULL nonce
- An attacker cannot replay with a colliding nonce since signature won't verify
- Only causes reduced nonce space (2^72 instead of 2^128)
- At most a DoS/griefing vector if nonces poorly generated

**Proof:** `test/EthenaMintingAnalysis.t.sol`

---

### 8. veiZi (0xB56A454d8DaC2AD4cB82337887717a2a427Fcd00)

**Status: NO ACTIVE REWARDS TO EXPLOIT**

**State:**
- Token: 0x9ad37205d608B8b219e6a2573f922094CEc5c200 (iZi)
- Total Staked iZi: 456,236,741
- Total NFT Supply: 494
- Staked NFTs: 205

**Reward Analysis:**
- rewardPerSecond = 0 (rewards not active)
- Provider balance: only 12M vs 456M staked
- No flash stake possible (tokens are locked until expiry)

**Proof:** `test/VeiZiAnalysis.t.sol`

---

### 9. CollateralVault (0x5d2725fde4d7aa3388da4519ac0449cc031d675f)

**Status: STANDARD IMPLEMENTATION - NO IMMEDIATE EXPLOIT**

**Analysis:**
- Uses EIP712 signatures with nonce tracking
- Collateralizable contracts must be governance-approved
- Withdrawal fees protect against rapid in/out
- All critical functions require approved contract caller

**Why Not Exploitable:**
- Unprivileged attacker cannot become collateralizable contract
- Signatures protected by nonces
- Standard security patterns implemented

---

### 10. GammaFarm (0x5Dc58f812b2e244DABA2fabd33f399cD699D7Ddc)

**Status: NO IMMEDIATE EXPLOIT**

**State:**
- LUSD Balance: 0 (staked in Liquity stability pool)
- MAL Balance: 17,980 tokens
- Total LUSD Staked: 2,380,014 LUSD
- Not in emergency state
- Daily rewards: ~365 MAL
- Decay factor: 0.9983 per day

**Analysis:**
- Profit factor calculation: (reward + ending_stake) / beginning_stake
- Could theoretically inflate CumS if beginning stake is small
- BUT: Stability pool gains are proportional to stake
- Small stake = small gains = no profit factor inflation

**Why Not Exploitable:**
- Gains from stability pool proportional to stake
- Cannot inflate profit factor with small deposits
- Epoch reset protects against bad state inheritance

**Proof:** `test/GammaFarmAnalysis.t.sol`

---

## Summary

**PROVEN EXPLOITS:** 0
- No immediately exploitable vulnerabilities with > $1000 profit found

**THEORETICAL ISSUES:** 3
- DolaSavings flash stake (blocked by 0 DBR balance)
- st1INCH retroactive pod add (depends on pod implementations)
- EthenaMinting nonce bitmap collision (design inefficiency, not exploitable)

**DESIGN DECISIONS:** 1
- Eigen totalSupply() override

**NO ISSUES FOUND:** 5
- Chainlink RewardVault
- AevoStaking
- veiZi (no active rewards)
- CollateralVault
- GammaFarm (profit factor exploit not viable)

**UNABLE TO TEST:** 1
- Curve Peg Keeper V2

---

## Key Observations

### Common Patterns in contracts.txt:
1. **Proxies Everywhere**: ~70% of contracts are TransparentUpgradeableProxy or similar
2. **Standard Implementations**: Most use OpenZeppelin patterns correctly
3. **Inactive Rewards**: Multiple staking contracts have 0 emission rates
4. **Proper Access Control**: Role-based systems properly implemented

### Attack Vectors Explored:
1. Flash loan + stake → blocked by locking requirements
2. Signature replay → blocked by nonces
3. Reward calculation precision → properly scaled with Q128
4. Retroactive pod/reward addition → design-dependent
5. Nonce collision → only affects nonce space, not exploitable

---

## Next Steps for Future Analysis

1. Monitor DolaSavings for when DBR balance becomes non-zero
2. Watch for new pod implementations on 1inch st1INCH
3. Check implementations behind proxy contracts
4. Look for contracts with:
   - Active reward balances
   - Custom accounting logic
   - Bridge/cross-chain components
   - Uninitialized proxy implementations

---

## Test Files Created

1. `test/ImmediateExploitSearch.t.sol` - DolaSavings analysis
2. `test/St1inchPodsAnalysis.t.sol` - st1INCH pods analysis
3. `test/RewardVaultAnalysis.t.sol` - Chainlink RewardVault
4. `test/CurvePegKeeperAnalysis.t.sol` - Curve Peg Keeper
5. `test/AevoStakingAnalysis.t.sol` - Aevo staking
6. `test/EthenaMintingAnalysis.t.sol` - EthenaMinting nonce analysis
7. `test/VeiZiAnalysis.t.sol` - veiZi voting escrow
8. `test/GammaFarmAnalysis.t.sol` - GammaFarm profit factor analysis

---

*Analysis performed on mainnet fork via Infura*
*Date: 2026-01-17*
