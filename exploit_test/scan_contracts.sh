#!/bin/bash

# Scan contracts for exploitable patterns
RPC="https://mainnet.infura.io/v3/bfc7283659224dd6b5124ebbc2b14e2c"

echo "=== SCANNING CONTRACTS FOR EXPLOITABLE PATTERNS ==="

# Read first 50 contracts
head -50 /home/user/contracs/contracts.txt | while read addr; do
    if [ -z "$addr" ]; then continue; fi

    # Check if contract exists
    code=$(cast code $addr --rpc-url $RPC 2>/dev/null)
    if [ "$code" == "0x" ] || [ -z "$code" ]; then
        continue
    fi

    echo ""
    echo "=== $addr ==="

    # Check owner()
    owner=$(cast call $addr "owner()(address)" --rpc-url $RPC 2>/dev/null)
    if [ ! -z "$owner" ]; then
        echo "Owner: $owner"
        if [ "$owner" == "0x0000000000000000000000000000000000000000" ]; then
            echo "*** ZERO OWNER ***"
        fi
    fi

    # Check pendingOwner()
    pending=$(cast call $addr "pendingOwner()(address)" --rpc-url $RPC 2>/dev/null)
    if [ ! -z "$pending" ] && [ "$pending" != "0x0000000000000000000000000000000000000000" ]; then
        echo "*** PENDING OWNER: $pending ***"
    fi

    # Check implementation slot (EIP-1967)
    impl=$(cast storage $addr 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc --rpc-url $RPC 2>/dev/null)
    if [ ! -z "$impl" ] && [ "$impl" != "0x0000000000000000000000000000000000000000000000000000000000000000" ]; then
        impl_addr=$(echo $impl | sed 's/0x000000000000000000000000/0x/')
        echo "Implementation: $impl_addr"
    fi

    # Check paused state
    paused=$(cast call $addr "paused()(bool)" --rpc-url $RPC 2>/dev/null)
    if [ "$paused" == "true" ]; then
        echo "*** CONTRACT IS PAUSED ***"
    fi

done
