// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "forge-std/Script.sol";
import "forge-std/console.sol";

interface IERC20 {
    function balanceOf(address) external view returns (uint256);
    function approve(address, uint256) external returns (bool);
    function transfer(address, uint256) external returns (bool);
}

interface IAutopool {
    function totalAssets() external view returns (uint256);
    function totalSupply() external view returns (uint256);
    function deposit(uint256, address) external returns (uint256);
    function redeem(uint256, address, address) external returns (uint256);
    function updateDebtReporting(uint256) external;
    function getAssetBreakdown() external view returns (uint256, uint256, uint256, uint256);
    function convertToAssets(uint256) external view returns (uint256);
}

contract ExploitScript is Script {
    address constant AUTOPOOL = 0xa7569A44f348d3D70d8ad5889e50F78E33d80D35;
    address constant USDC = 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48;
    address constant EXECUTOR = 0x1A65E4844a3AF0F1733ee9e1A474dc7DB3c396a3;

    function run() external {
        console.log("=== EXPLOIT VALIDATION SCRIPT ===");
        console.log("Block:", block.number);

        IAutopool pool = IAutopool(AUTOPOOL);

        // Read state
        uint256 assets = pool.totalAssets();
        uint256 supply = pool.totalSupply();
        console.log("Total Assets:", assets);
        console.log("Total Supply:", supply);

        (uint256 idle, uint256 debt, uint256 min, uint256 max) = pool.getAssetBreakdown();
        console.log("Idle:", idle);
        console.log("Debt:", debt);
        console.log("Min:", min);
        console.log("Max:", max);
        console.log("Spread:", max - min);
    }
}
