// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "forge-std/Test.sol";

interface IAkuAuction {
    function owner() external view returns (address);
    function refundProgress() external view returns (uint256);
    function totalBids() external view returns (uint256);
    function bidIndex() external view returns (uint256);
    function expiresAt() external view returns (uint256);
    function allBids(uint256) external view returns (address bidder, uint80 price, uint8 bidsPlaced, uint8 finalProcess);
    function personalBids(address) external view returns (uint256);
    function akuNFTs() external view returns (address);
    function getPrice() external view returns (uint80);
    function processRefunds() external;
    function emergencyWithdraw() external;
}

interface IAkuNFT {
    function airdropProgress() external view returns (uint256);
}

contract AkuAuctionExploitTest is Test {
    address constant AKU_AUCTION = 0xF42c318dbfBaab0EEE040279C6a2588Fa01a961d;
    
    IAkuAuction auction;
    
    function setUp() public {
        vm.createSelectFork("https://mainnet.infura.io/v3/bfc7283659224dd6b5124ebbc2b14e2c");
        auction = IAkuAuction(AKU_AUCTION);
    }
    
    function testAuctionState() public view {
        console.log("=== AKU AUCTION STATE ===");
        console.log("ETH Balance:", AKU_AUCTION.balance / 1e18, "ETH");
        
        address owner = auction.owner();
        console.log("Owner:", owner);
        
        uint256 refundProgress = auction.refundProgress();
        uint256 totalBids = auction.totalBids();
        uint256 bidIndex = auction.bidIndex();
        uint256 expiresAt = auction.expiresAt();
        
        console.log("\nBid State:");
        console.log("  refundProgress:", refundProgress);
        console.log("  totalBids:", totalBids);
        console.log("  bidIndex:", bidIndex);
        console.log("  expiresAt:", expiresAt);
        console.log("  currentTime:", block.timestamp);
        
        address nftContract = auction.akuNFTs();
        console.log("\nNFT Contract:", nftContract);
        
        if (nftContract != address(0)) {
            try IAkuNFT(nftContract).airdropProgress() returns (uint256 prog) {
                console.log("airdropProgress:", prog);
            } catch {}
        }
        
        console.log("\n=== CLAIM REQUIREMENTS ===");
        console.log("refundProgress >= totalBids?", refundProgress >= totalBids ? "YES" : "NO");
    }
}
