// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "forge-std/Test.sol";

/**
 * @title High Value Scanner
 * @notice Find contracts with significant token balances
 */
contract HighValueScannerTest is Test {

    address WETH;
    address USDC;
    address USDT;
    address LINK;
    address WBTC;

    function setUp() public {
        vm.createSelectFork("https://mainnet.infura.io/v3/bfc7283659224dd6b5124ebbc2b14e2c");
        WETH = vm.parseAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2");
        USDC = vm.parseAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48");
        USDT = vm.parseAddress("0xdAC17F958D2ee523a2206206994597C13D831ec7");
        LINK = vm.parseAddress("0x514910771AF9Ca656af840dff83E8264EcF986CA");
        WBTC = vm.parseAddress("0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599");
    }

    function test_scanHighValue() public {
        console.log("=== SCANNING FOR HIGH VALUE CONTRACTS ===");

        // Contracts from contracts.txt known to have value
        address[] memory targets = new address[](20);
        targets[0] = vm.parseAddress("0xFA7093CDD9EE6932B4eb2c9e1cde7CE00B1FA4b9");  // Railgun
        targets[1] = vm.parseAddress("0x889edC2eDab5f40e902b864aD4d7AdE8E412F9B1");  // Lido
        targets[2] = vm.parseAddress("0x7623e9DC0DA6FF821ddb9EbABA794054E078f8c4");  // EarlyAdopterPool
        targets[3] = vm.parseAddress("0x996913c8c08472f584ab8834e925b06D0eb1D813");  // RewardVault
        targets[4] = vm.parseAddress("0xE5f24791E273Cb96A1f8E5B67Bc2397F0AD9B8B4");  // DolaSavings
        targets[5] = vm.parseAddress("0x5Dc58f812b2e244DABA2fabd33f399cD699D7Ddc");  // GammaFarm
        targets[6] = vm.parseAddress("0x46b2DeAe6eFf3011008EA27EA36b7c27255ddFA9");  // wDYDX
        targets[7] = vm.parseAddress("0x9A0C8Ff858d273f57072D714bca7411D717501D7");  // st1INCH
        targets[8] = vm.parseAddress("0xec53bF9167f50cDEB3Ae105f56099aaaB9061F83");  // EIGEN
        targets[9] = vm.parseAddress("0x6982508145454Ce325dDbE47a25d4ec3d2311933");  // PEPE
        targets[10] = vm.parseAddress("0x93eB25e380229bFed6AB4Bf843e5f670c12785E3"); // Unknown
        targets[11] = vm.parseAddress("0x439A5F0f5e8D149ddA9a0ca367d4a8e4d6F83C10"); // Unknown
        targets[12] = vm.parseAddress("0x9040e41ef5e8b281535a96d9a48acb8cfabd9a48"); // Unknown
        targets[13] = vm.parseAddress("0x76943C0D61395d8F2EdF9060E1533529cAe05DE6"); // Unknown
        targets[14] = vm.parseAddress("0x98078db053902644191f93988341e31289E1c8fE"); // Unknown
        targets[15] = vm.parseAddress("0x2c24b57E2CCd1F273045aF6a5f632504c432374F"); // Unknown
        targets[16] = vm.parseAddress("0x57ba429517c3473b6d34ca9acd56c0e735b94c02"); // Unknown
        targets[17] = vm.parseAddress("0x6d00268a47d48474f999c18210c6877491ae6fb3"); // Unknown
        targets[18] = vm.parseAddress("0x0ec3d6c1ab3011fbef46f6132468b96eee74148a"); // Unknown
        targets[19] = vm.parseAddress("0x231278edd38b00b07fbd52120cef685b9baebcc1"); // Unknown

        for (uint i = 0; i < targets.length; i++) {
            address target = targets[i];
            _checkBalance(target);
        }
    }

    function _checkBalance(address target) internal view {
        uint256 ethBal = target.balance;
        bool hasValue = false;

        // Check WETH
        (bool s, bytes memory d) = WETH.staticcall(
            abi.encodeWithSignature("balanceOf(address)", target)
        );
        uint256 wethBal;
        if (s && d.length >= 32) {
            wethBal = abi.decode(d, (uint256));
        }

        // Check USDC
        (s, d) = USDC.staticcall(
            abi.encodeWithSignature("balanceOf(address)", target)
        );
        uint256 usdcBal;
        if (s && d.length >= 32) {
            usdcBal = abi.decode(d, (uint256));
        }

        // Check LINK
        (s, d) = LINK.staticcall(
            abi.encodeWithSignature("balanceOf(address)", target)
        );
        uint256 linkBal;
        if (s && d.length >= 32) {
            linkBal = abi.decode(d, (uint256));
        }

        // Print if significant value
        if (ethBal > 1 ether || wethBal > 1 ether || usdcBal > 1000e6 || linkBal > 100e18) {
            hasValue = true;
            console.log("");
            console.log("TARGET:", target);
            if (ethBal > 0) console.log("  ETH:", ethBal / 1e18);
            if (wethBal > 0) console.log("  WETH:", wethBal / 1e18);
            if (usdcBal > 0) console.log("  USDC:", usdcBal / 1e6);
            if (linkBal > 0) console.log("  LINK:", linkBal / 1e18);
        }
    }

    function test_scanMoreContracts() public {
        console.log("=== SCANNING MORE CONTRACTS ===");

        // More from contracts.txt
        address[] memory targets = new address[](20);
        targets[0] = vm.parseAddress("0x0b58ca72b12f01fc05f8f252e226f3e2089bd00e");
        targets[1] = vm.parseAddress("0x4c21b7577c8fe8b0b0669165ee7c8f67fa1454cf");
        targets[2] = vm.parseAddress("0x8ca7a5d6f3acd3a7a8bc468a8cd0fb14b6bd28b6");
        targets[3] = vm.parseAddress("0xd60247c6848b7ca29eddf63aa924e53db6ddd8ec");
        targets[4] = vm.parseAddress("0x96c68d861ada016ed98c30c810879f9df7c64154");
        targets[5] = vm.parseAddress("0x6f8f1266565d3a7dd05c30ebf64faf509e4be61a");
        targets[6] = vm.parseAddress("0x439cac149b935ae1d726569800972e1669d17094");
        targets[7] = vm.parseAddress("0x4e264618dc015219cd83dbc53b31251d73c2db1a");
        targets[8] = vm.parseAddress("0xda5928d59ece82808af2cbbe4f2872fea8e12cd6");
        targets[9] = vm.parseAddress("0xec6b8a3f3605b083f7044c0f31f2cac0caf1d469");
        targets[10] = vm.parseAddress("0x5c697fee285b513711a816018dbb34dc0cfc4875");
        targets[11] = vm.parseAddress("0xdcee70654261af21c44c093c300ed3bb97b78192");
        targets[12] = vm.parseAddress("0x2290eefea24a6e43b26c27187742bd1fedc10bdb");
        targets[13] = vm.parseAddress("0x1102471eb3378fee427121c9efcea452e4b6b75e");
        targets[14] = vm.parseAddress("0xc128a9954e6c874ea3d62ce62b468ba073093f25");
        targets[15] = vm.parseAddress("0xbe1ea5fa6dba700d2c94a0bc6c9faf197550d323");
        targets[16] = vm.parseAddress("0x6ef103e88e6d32c28b98f0d583a5b3092c9b65e1");
        targets[17] = vm.parseAddress("0x3d0bb1ccab520a66e607822fc55bc921738fafe3");
        targets[18] = vm.parseAddress("0x85b6f9bddb10c6b320d07416a250f984f0f0e9ed");
        targets[19] = vm.parseAddress("0x4f0fd563be89ec8c3e7d595bf3639128c0a7c33a");

        for (uint i = 0; i < targets.length; i++) {
            address target = targets[i];
            _checkBalance(target);
        }
    }

    function test_deepScanKnownHighValue() public {
        console.log("=== DEEP SCAN KNOWN HIGH VALUE ===");

        // Railgun - 16,845 WETH
        address railgun = vm.parseAddress("0xFA7093CDD9EE6932B4eb2c9e1cde7CE00B1FA4b9");
        console.log("");
        console.log("RAILGUN:", railgun);

        (bool s, bytes memory d) = WETH.staticcall(
            abi.encodeWithSignature("balanceOf(address)", railgun)
        );
        if (s && d.length >= 32) {
            uint256 bal = abi.decode(d, (uint256));
            console.log("WETH:", bal / 1e18);
        }

        // Lido unstETH - 26,799 ETH
        address lido = vm.parseAddress("0x889edC2eDab5f40e902b864aD4d7AdE8E412F9B1");
        console.log("");
        console.log("LIDO UNSTETH:", lido);
        console.log("ETH:", lido.balance / 1e18);

        // EarlyAdopterPool - 627 ETH
        address eap = vm.parseAddress("0x7623e9DC0DA6FF821ddb9EbABA794054E078f8c4");
        console.log("");
        console.log("EARLYADOPTERPOOL:", eap);
        console.log("ETH:", eap.balance / 1e18);

        // RewardVault - 2.7M LINK
        address rv = vm.parseAddress("0x996913c8c08472f584ab8834e925b06D0eb1D813");
        console.log("");
        console.log("REWARDVAULT:", rv);
        (s, d) = LINK.staticcall(
            abi.encodeWithSignature("balanceOf(address)", rv)
        );
        if (s && d.length >= 32) {
            uint256 bal = abi.decode(d, (uint256));
            console.log("LINK:", bal / 1e18);
        }
    }
}
